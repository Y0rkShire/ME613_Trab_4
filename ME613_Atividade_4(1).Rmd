---
title: "Coloque seu titulo aqui"
author:
  - Aluno 1 RA
  - Aluno 2 RA
header-includes:
   - \usepackage[brazil]{babel}
bibliography: referencia.bib
output:
 bookdown::pdf_document2:
     toc: FALSE
---

```{r setup, include=FALSE}
#não altere nada aqui
knitr::opts_chunk$set(echo = FALSE)
options(knitr.table.format = "latex")
options(scipen = 999,digits=2)
```


```{r,message=FALSE}
temp <- read.csv(choose.files())
```

```{r,message=FALSE}
library(car)
library(tidyverse)
library(GGally)
library(leaps)
```


# Introdução





# Banco de dados

<!-- sua conclusao a partir dos dados e recomendacoes-->

### Covariáveis:
* year_of_reference: Ano de referência na coleta dos dados  
* month_of_reference: Mês de referência na coleta dos dados  
* fipe_code: ID de cada marca  
* authentication: Código de autenticação único para cada consulta no site da FIPE.  
* brand: Marca montadora do veículo
* model: Nome do modelo do carro
* fuel: Combustível do carro. Alguns dos carros indicados como gasolina são na verdade flex(gasolina+álcool)
* gear: Tipo do câmbio.
* engine_size: Tamanho do motor em centímetros cubicos.
* year_model:  Corresponde ao primeiro ano de referência do carro, 1 posterior ao ano de fabricação.
* avg_price_brl: Preço médio do carro, medido pela FIPE no Brasil.
* age_years: Idade do modelo em anos.

# Análise exploratória



Começamos escolhendo um mês como referência, para evitar dependência temporal.

```{r vereificação dos dados}
dados <- temp %>% dplyr::filter(month_of_reference == "November")
```

realizamos a análise descritiva dos dados, buscando por anormalidades.

```{r}
boxplot(dados$engine_size)
boxplot(dados$year_model)
hist(dados$avg_price_brl) 
```

Não encontrado outliers ou comportamentos inesperados, analisamos a correlação dois a dois:
```{r}
#aqui foram analisados os dados por outliers foram validados os dados para análise
ggpairs(dados[c(9,11,12)])
#apos não perceber nenhuma correlação perceptivel direta entre as variáveis assumimos independencia 

```

Removemos variáveis irrelevantes para o modelo, e reclassificamos as marcas de carro considerando os principais modelos (com mais observações) e outros.
```{r tratamento de dados}
dados <- dados[-c(3,4,6,10)]

`%nin%` = Negate(`%in%`)
dados$brand <- ifelse(dados$brand %nin% c("VW - VolksWagen","Fiat","GM - Chevrolet","BMW","Mercedes-Benz","Renault","Peugeot","Ford","Citroën","Audi","Hyundai","Mitsubishi"),"Alternativos",dados$brand)
```

Começando a definir os objetivos do modelo, filtramos as observações para uma faixa de preço usual no consumo médio brasileiro (até R$100 000)
```{r}
dados <- dados %>% filter(avg_price_brl < 100000)
#analisando carros de preço acessivel
```


Inicialmente, consideramos

```{r}
summary(lm(avg_price_brl/1000 ~  age_years +as.factor(brand)+ as.factor(gear) + engine_size + as.factor(fuel),dados))

model <- lm(avg_price_brl ~  age_years +as.factor(brand)+ as.factor(gear) + engine_size + as.factor(fuel),dados)

plot(model)

model <- lm(log(avg_price_brl) ~  age_years +as.factor(brand)+ as.factor(gear) + engine_size + as.factor(fuel),dados)
summary(model)


qqnorm(model$residuals)
qqline(model$residuals)
hist(model$residuals)
plot(model)

car::vif(model)

avPlots(model)
```

```{r}
leaps <- regsubsets(log(avg_price_brl) ~  age_years +as.factor(brand)+ as.factor(gear) + engine_size + as.factor(fuel), nbest= 1,data = dados,nvmax = 18)

plot(leaps,scale = "bic")

plot(summary(leaps)$bic,type = "l")
plot(summary(leaps)$rsq,type = "l")
plot(summary(leaps)$cp,type = "l")
plot(summary(leaps)$adjr2,type = "l")
plot(summary(leaps)$rss, type = "l")
```


```{r}
library(leaps)

model <- lm(log(avg_price_brl) ~  age_years +as.factor(brand)+ as.factor(gear) + engine_size + as.factor(fuel)+
              age_years*as.factor(brand)+ age_years*as.factor(gear) + age_years*engine_size + age_years*as.factor(fuel)+
              as.factor(brand)*as.factor(gear) + as.factor(brand)*engine_size + as.factor(brand)*as.factor(fuel)+
              as.factor(gear)*engine_size + as.factor(gear)*as.factor(fuel)+
              engine_size*as.factor(fuel)
            ,dados)
summary(model)


qqnorm(model$residuals)
qqline(model$residuals)
hist(model$residuals)
plot(model)

leaps <- regsubsets(log(avg_price_brl) ~  age_years +as.factor(brand)+ as.factor(gear) + engine_size + as.factor(fuel)+
+                age_years*as.factor(brand)+ age_years*as.factor(gear) + age_years*engine_size + age_years*as.factor(fuel)+
+                as.factor(brand)*as.factor(gear) + as.factor(brand)*engine_size + as.factor(brand)*as.factor(fuel)+
+                as.factor(gear)*engine_size + as.factor(gear)*as.factor(fuel)+
+                engine_size*as.factor(fuel), nbest = 1,nvmax = 174,data = dados,really.big = T, method = "forward")

plot(leaps,scale = "Cp")

as.matrix(summary(leaps)) -> a
a_matrix <- as.data.frame(a[1])

plot(summary(leaps)$bic,type = "l")
plot(summary(leaps)$rsq,type = "l")
plot(summary(leaps)$cp,type = "l")
plot(summary(leaps)$adjr2,type = "l")
plot(summary(leaps)$rss, type = "l")

## 11483-11845 é uma caminhonete nissan 6.5 15000 reais
```

A média da variável X é `r media`.

# Considerações finais

<!-- sua conclusao a partir dos dados e recomendacoes-->

# Bibliografia

<!-- não coloque nada aqui, será feito automaticamente se vc usar .bib e @ para citar referencias no texto, conforme o video explicativo indicado no roteiro-->
